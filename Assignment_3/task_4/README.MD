# Assignment 3 - Task 4 (CUDA): Оптимизация конфигурации сетки и блоков потоков

В данном задании для **ранее реализованной CUDA-программы поэлементного сложения массивов (Vector Add)** была выполнена настройка параметров конфигурации вычислений на GPU — **размера блока потоков (block size)** и соответствующего **размера сетки (grid size)**.  
Цель работы - сравнить производительность **неоптимальной** и **оптимизированной** конфигураций и показать эффект подбора параметров запуска ядра.

## Выбранная программа
В качестве основы использована программа из **Task 2**: C[i] = A[i] + B[i]

Причина выбора:
- простое и детерминированное CUDA-ядро;
- отсутствие дополнительных факторов (shared memory, сложной арифметики);
- влияние конфигурации block/grid хорошо изолируется и легко анализируется.

## Параметры эксперимента

- Размер массива: `N = 1 000 000`
- Количество запусков для усреднения времени: `300`
- Тип измерения: среднее время выполнения **CUDA-ядра** (`cudaEvent`)
- Проверка корректности: сравнение с CPU-эталоном (`Max abs error`, `EPS = 1e-4`)

## Неоптимальная конфигурация
В качестве **неоптимальной** была выбрана конфигурация с максимально возможным размером блока:
- `Block = 1024`
- `Grid = 977`

Результат: Avg kernel time = 0.051041 ms

## Поиск оптимальной конфигурации
Был выполнен перебор нескольких значений размера блока потоков: {64, 128, 192, 256, 320, 384, 512, 768, 1024}


Для каждого варианта измерялось среднее время выполнения ядра.

### Результаты измерений

| Block size | Grid size | Avg kernel time (ms) |
|-----------:|----------:|---------------------:|
| 64         | 15625     | 0.050443             |
| 128        | 7813      | 0.049277             |
| 192        | 5209      | 0.049332             |
| 256        | 3907      | 0.049268             |
| 320        | 3125      | 0.049561             |
| 384        | 2605      | 0.053617             |
| 512        | 1954      | 0.049410             |
| 768        | 1303      | 0.057458             |
| 1024       | 977       | 0.051009             |

## Оптимизированная конфигурация

Лучший результат был получен при:
- **Block = 256**
- **Grid = 3907**

Результат: Avg kernel time = 0.049268 ms

## Сравнение производительности
| Конфигурация     | Block | Grid | Avg time (ms) |
|------------------|-------|------|---------------|
| Неоптимальная    | 1024  | 977  | 0.051041      |
| Оптимизированная | 256   | 3907 | 0.049268      |

Ускорение: Speedup = 1.035992×

## Проверка корректности
Корректность вычислений подтверждена:
Correct = YES
Max abs error = 0.000000

## Анализ результатов
Полученные результаты показывают, что:
- слишком большие блоки (1024 потока) могут снижать **occupancy** и эффективность планирования потоков;
- размеры блока в диапазоне **128–512 потоков** обеспечивают более стабильную и высокую производительность;
- размер блока **256 потоков** является оптимальным компромиссом между:
  - эффективным использованием warp (32 потока),
  - числом активных блоков на SM,
  - нагрузкой на регистры и планировщик.
Несмотря на то, что ускорение относительно неоптимальной конфигурации оказалось умеренным (≈3.6%), эксперимент наглядно демонстрирует важность подбора параметров запуска CUDA-ядра.

## Вывод
В ходе задания была показана практическая процедура подбора оптимальных параметров конфигурации CUDA-ядра. Даже для простой задачи поэлементного сложения массивов корректный выбор размера блока потоков позволяет добиться лучшей производительности.  
Для данной программы оптимальной оказалась конфигурация с размером блока **256 потоков**, что соответствует общепринятым рекомендациям для CUDA-программ.
